!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("underscore"),require("underscore-contrib"),require("underscore.string"),require("jquery"),require("backbone"),require("backbone.radio"),require("backbone-associations"),require("backbone.marionette"),require("i18next"),require("numeral"),require("moment"),require("moment-range"),require("moment-timezone")):"function"==typeof define&&define.amd?define(["underscore","underscore-contrib","underscore.string","jquery","backbone","backbone.radio","backbone-associations","backbone.marionette","i18next","numeral","moment","moment-range","moment-timezone"],e):t.Marionettist=e(t._,t.underscoreContrib,t.s,t.$,t.Backbone,t.Backbone.Radio,t.backboneAssociations,t.Marionette,t.i18next,t.numeral,t.moment,t.momentRange,t.momentTimezone)}(this,function(t,e,r,n,o,i,u,s,c,p,l,a,f){"use strict";t="default"in t?t["default"]:t,r="default"in r?r["default"]:r,n="default"in n?n["default"]:n,o="default"in o?o["default"]:o,s="default"in s?s["default"]:s,c="default"in c?c["default"]:c,p="default"in p?p["default"]:p,l="default"in l?l["default"]:l;var y;y=s.extend(),y.Backbone=o,y.Marionette=s,y._=t,y.$=n,y.s=r,y.I18n=c,y.numeral=p,y.moment=l;var h,g=y,d=function(t,e){function r(){this.constructor=t}for(var n in e)w.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},w={}.hasOwnProperty;h=function(t){function e(){this.stage="development"}return d(e,t),e.prototype.isDevelopment=function(){return"development"===this.stage},e.prototype.isProduction=function(){return"production"===this.stage},e.prototype.getLocale=function(){return g.I18n.language},e.prototype.setStage=function(t){var e;return e=this.stage,this.stage=t,this.triggerMethod("change:stage",e,t)},e.prototype.getStage=function(){return this.stage},e.prototype.setLocale=function(t,e){var r;return null==t&&(t="en"),null==e&&(e=null),r=this.getLocale(),g.I18n.changeLanguage(t,function(n){return g.channels.publish("marionettist","change:locale",{currentLocale:t,oldLocale:r}),g._.isFunction(e)?e(n):void 0})},e}(g.Object);var v,m=h,b=function(t,e){function r(){this.constructor=t}for(var n in e)O.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},O={}.hasOwnProperty;v=function(t){function e(){}return b(e,t),e.prototype.request=function(t,e,r){return null==t&&(t="global"),null==e&&(e=""),null==r&&(r={}),g.Backbone.Radio.channel(t).request(e,r)},e.prototype.replyOnce=function(t,e,r){var n;return null==t&&(t="global"),null==e&&(e=""),n=g.Backbone.Radio.channel(t),g._.isFunction(r)?n.replyOnce(e,r):n.replyOnce(r)},e.prototype.reply=function(t,e,r){var n;return null==t&&(t="global"),null==e&&(e=""),n=g.Backbone.Radio.channel(t),g._.isFunction(r)?n.reply(e,r):n.reply(r)},e.prototype.publish=function(t,e,r){return null==t&&(t="global"),null==e&&(e=""),null==r&&(r={}),g.Backbone.Radio.channel(t).trigger(e,r)},e.prototype.subscribe=function(t,e,r){return null==t&&(t="global"),null==e&&(e=""),g.Backbone.Radio.channel(t).on(e,r)},e}(g.Object);var k,R=v,F=function(t,e){function r(){this.constructor=t}for(var n in e)M.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},M={}.hasOwnProperty;k=function(t){function e(){}return F(e,t),e.prototype.refreshRoute=function(t){return null==t&&(t=this.getCurrentRoute()),g.Backbone.history.loadUrl(t)},e.prototype.navigateTo=function(t,e){return null==e&&(e={}),g.Backbone.history.navigate(t,e)},e.prototype.getCurrentRoute=function(){var t;return t=g.Backbone.history.fragment,g._.isEmpty(t)?null:t},e.prototype.startHistory=function(t){return null==t&&(t={}),null!=g.Backbone.history?g.Backbone.history.start(t):void 0},e}(g.Object);var P,x=k;P=function(){function t(){}return t.prototype.debug=!1,t.prototype.lookupPaths=[],t.prototype.engine=function(){var t;return t={},"undefined"!=typeof HAML&&null!==HAML&&(t=HAML),"undefined"!=typeof JST&&null!==JST&&(t=JST),t},t.prototype.render=function(t,e,r){var n,o;return null==t&&(t=""),null==e&&(e={}),null==r&&(r={}),o="",n=this.engine,g._.isFunction(t)&&(n=n()),null!=r.defaultTemplate&&(o=r.defaultTemplate),null!=n&&g._.isFunction(n[t])&&(o=n[t](e)),o},t}();var j,C=P,V=function(t,e){function r(){this.constructor=t}for(var n in e)B.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},B={}.hasOwnProperty;j=function(t){function e(){this.templates=new C}return V(e,t),e}(g.Object);var T,q=j;T={render:function(t,e){var r;if(Marionettist._.isFunction(t))return t(e);if(t!==!1){if(r=this.getTemplate(t),!Marionettist._.isFunction(r))throw"Template "+t+" was not found!";return r(e)}},getTemplate:function(t){var e,r,n,o,i,u,s,c,p;if(s=Marionettist.config.templates.lookupPaths,Marionettist._.isFunction(s)&&(s=s()),!Marionettist._.isArray(s))throw"lookupPaths most be an array";for(p=[t],0===s.length&&(s=[""]),e=0,n=s.length;n>e;e++)for(i=s[e],r=0,o=p.length;o>r;r++)if(c=p[r],u=this.findLookupPath(i+c,t),null!=u)return u},findLookupPath:function(t,e){var r,n;return r=Marionettist.config.templates.engine,Marionettist._.isFunction(r)&&(r=r()),n=r[t],Marionettist.config.templates.debug===!0&&Marionettist.logger.info("Looking template: "+e+" in '"+t+"'"),n?n:void 0},withTemplate:function(t){var e;return null!=t?(e=t.split("/"),e.splice(-1,0,"templates"),e.join("/")):void 0}};var A,L=T,E=function(t,e){function r(){this.constructor=t}for(var n in e)z.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},z={}.hasOwnProperty;A=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return E(e,t),e.prototype.pathFor=function(t){var e;return e="",e="#"+t},e.prototype.waitFor=function(t,e){var r,n;return null==e&&(e={}),n=[],n=_.chain([t]).flatten().value(),(r=g.$).when.apply(r,n).then(function(){return g._.isFunction(e.success)?e.success():void 0},function(t){return g._.isFunction(e.error)?e.error():void 0})},e}(g.Object);var S,D=A,H=function(t,e){function r(){this.constructor=t}for(var n in e)I.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},I={}.hasOwnProperty;S=function(t){function e(){}return H(e,t),e.prototype.success=function(t,e){return null==e&&(e={}),e.type="success",this.log(t,e)},e.prototype.warn=function(t,e){return null==e&&(e={}),e.type="warn",this.log(t,e)},e.prototype.error=function(t,e){return null==e&&(e={}),e.type="error",this.log(t,e)},e.prototype.info=function(t,e){return null==e&&(e={}),e.type="info",this.log(t,e)},e.prototype.log=function(t,e){var r,n,o;if(null==e&&(e={}),n=e.force,o=e.type,g.env.isDevelopment()||n===!0){switch(o=o||"black",r="White",o){case"success":o="Green",r="LimeGreen";break;case"info":o="DodgerBlue",r="Turquoise";break;case"error":o="Red",r="Black";break;case"start":o="OliveDrab",r="PaleGreen";break;case"warning":o="Tomato",r="Black";break;case"end":o="Orchid",r="MediumVioletRed";break;default:o=o}r="White","object"==typeof t?console.log(t):console.log("%c"+t,"type:"+o+";font-weight:bold; background-type: "+r+";")}},e}(g.Object);var N,$=S,Y=function(t,e){function r(){this.constructor=t}for(var n in e)G.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},G={}.hasOwnProperty;N=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return Y(e,t),e.prototype.router=function(){return this.getOption("router")},e.prototype.path=function(){return this.getOption("path")},e.prototype.actionName=function(){return this.getOption("actionName")},e.prototype.controller=function(){return this.getOption("controller")},e}(g.Object);var J,W=N,U=function(t,e){function r(){this.constructor=t}for(var n in e)K.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},K={}.hasOwnProperty;J=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return U(e,t),e.prototype.onRoute=function(t,e,r){return null!=this.controller&&g._.isFunction(this.controller.onRoute)?this.controller.onRoute(this,t,e,r):void 0},e.prototype._setControllerFilters=function(t){var e,r;return null!=t&&(e={before:{},after:{}},r=t.filters,g._.isFunction(r)&&(r=r()),null==t.filters&&(t.filters={}),t.filters=g._.extend(e,r)),t},e.prototype._addAppRoute=function(t,e,r){var n,o;if(this.controller=this._setControllerFilters(t),n=t[r],o=function(t){return function(n){var o;return t.controller.route=new g.AppRoute({controller:t.controller,actionName:r,path:e}),o=t._executeFilter(t.controller.filters.before,t.controller),o!==!1?(t.controller[r].apply(t.controller,t._getParams()),t._executeFilter(t.controller.filters.after,t.controller)):void 0}}(this),!o)throw new g.Marionette.Error('Method "'+r+'" was not found on the controller');return this.route(e,r,g._.bind(o,t))},e.prototype._executeFilter=function(t,e){var r,n,o,i,u,s,c;for(s=!0,u=g._.keys(t),n=0,o=u.length;o>n;n++)switch(i=u[n],r=t[i],c="Action halted by filter '"+i+"'",!1){case!g._.isFunction(r):if(s=r(e),s===!1){"undefined"!=typeof console&&null!==console&&console.warn(c);break}break;case!g._.isObject(r):if(s=this._proccessFilterObject(i,r,e),s===!1){"undefined"!=typeof console&&null!==console&&console.warn(c);break}}return s},e.prototype._getParams=function(){var t,e;return e=this._routeToRegExp(this.controller.route.getOption("path")),t=this._extractParameters(e,g.Backbone.history.getFragment())},e.prototype._proccessFilterObject=function(t,e,r){var n,o,i,u;if(i={method:null,only:[],except:[]},u=g._.extend(i,e),o=r[t],n=r.route.actionName(),!_.isArray(u.only))throw"filter option only, most be an array";if(!_.isArray(u.except))throw"filter option except, most be an array";if(u.only.length>0||u.except.length>0){if(g._.contains(u.only,n)&&!g._.contains(u.except,n)&&g._.isFunction(o))return o.apply(this.controller,this._getParams())}else if(g._.isFunction(o))return o.apply(this.controller,this._getParams())},e}(g.AppRouter);var Q,X,Z=J,tt=function(t,e){function r(){this.constructor=t}for(var n in e)et.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},et={}.hasOwnProperty;X=s.Region.prototype.show,Q=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return tt(e,t),e.prototype.show=function(t,e){var r,n,o,i,u,s;if(e=e||{},o=e.preventDestroy===!0,u=e.transitionOut,delete e.transitionOut,r=[t,e],u===!1)return X.apply(this,r);if(n=this.currentView,i=function(t){return function(){return X.apply(t,r)}}(this),null!=n&&g._.isFunction(n.transitionOut)){if(n.triggerMethod("before:transition:out"),s=n.transitionOut(),null!=(null!=s?s.then:void 0))return s.then(function(t){return function(){return i()}}(this));throw"transitionOut method most return a promise"}return i()},e}(s.Region);var rt,nt=Q,ot=function(t,e){function r(){this.constructor=t}for(var n in e)it.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},it={}.hasOwnProperty,ut=[].slice;rt=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return ot(e,t),e.prototype.templateHelpers={pathFor:function(){var t,e;return t=1<=arguments.length?ut.call(arguments,0):[],(e=g.utils).pathFor.apply(e,t)},t:function(){var t,e;return t=1<=arguments.length?ut.call(arguments,0):[],(e=g.I18n).t.apply(e,t)},formatCurrency:function(t,e){return null==e&&(e="$0,0.00"),g.numeral(t).format(e)},formatNumber:function(t,e){return null==e&&(e="0,0.00"),g.numeral(t).format(e)},formatPercentage:function(t,e){return null==e&&(e="0.00%"),g.numeral(t).format(e)},formatDate:function(t,e){return null==e&&(e="DD-MM-YYYY"),g.moment(t).format(e)}},e}(g.Object);var st,ct=rt,pt=function(t,e){function r(){this.constructor=t}for(var n in e)lt.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},lt={}.hasOwnProperty;st=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return pt(e,t),e}(s.CollectionView);var at,ft=st,yt=function(t,e){function r(){this.constructor=t}for(var n in e)ht.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},ht={}.hasOwnProperty;at=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return yt(e,t),e}(s.CompositeView);var _t,gt=at,dt=function(t,e){function r(){this.constructor=t}for(var n in e)wt.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},wt={}.hasOwnProperty;_t=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return dt(e,t),e}(s.ItemView);var vt,mt=_t,bt=function(t,e){function r(){this.constructor=t}for(var n in e)Ot.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},Ot={}.hasOwnProperty;vt=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return bt(e,t),e}(s.LayoutView);var kt,Rt=vt,Ft=function(t,e){function r(){this.constructor=t}for(var n in e)Mt.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},Mt={}.hasOwnProperty;kt=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return Ft(e,t),e}(o.Model);var Pt,xt=kt,jt=function(t,e){function r(){this.constructor=t}for(var n in e)Ct.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},Ct={}.hasOwnProperty;Pt=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return jt(e,t),e}(o.Collection);var Vt,Bt=Pt,Tt=function(t,e){function r(){this.constructor=t}for(var n in e)qt.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},qt={}.hasOwnProperty,At=[].slice;Vt=function(t){function e(t){null==t&&(t={}),e.__super__.constructor.call(this,t),this._instance_id=g._.uniqueId("responder"),this.register(this,this._instance_id)}return Tt(e,t),e.prototype.loaderView=Rt.extend({template:function(t){return g.config.templates.render("marionettist/loader",t,{defaultTemplate:"<div class='mri-loader'>\n  <div class='mri-loader__content'>\n    <i class=\"fa fa-spinner fa-spin fa-2x fa-fw\"></i>\n    <span class=\"sr-only\">Loading...</span>\n  </div>\n</div>"})}}),e.prototype.getLoaderView=function(){return null==this.get("loaderView")&&this.set({loaderView:new this.loaderView}),this.get("loaderView")},e.prototype.close=function(){var t;return t=1<=arguments.length?At.call(arguments,0):[],e.__super__.close.call(this,t),this.unregister(this,this._instance_id)},e.prototype.show=function(t,e){var r,n;return null==e&&(e={}),n=null!=e.region?e.region:this.get("region"),this.listenTo(t,"close",this.close),null!=e.async?(r=this.getLoaderView(),this.listenTo(r,"close",this.close),n.show(r),this.fetch().then(function(e){return function(){return n.currentView!==r?t.close():n.show(t)}}(this))):n.show(t)},e.prototype.defaults={params:{},async:[]},e.prototype.waitFor=function(){var t,e;return t=1<=arguments.length?At.call(arguments,0):[],(e=g.utils).waitFor.apply(e,t)},e.prototype.deferred=function(){return g.$.Deferred()},e.prototype.fetch=function(t){var e,r;return null==t&&(t={}),r=this.deferred(),e=g._.chain([this.get("async")]).flatten().compact().value(),this.waitFor(e,{success:function(){return g._.isFunction(t.success)&&t.success(),r.resolve()},error:function(){return g._.isFunction(t.error)&&t.error(),r.reject()}}),r.promise()},e.prototype.save=function(){return this.deferred().promise()},e.prototype.destroy=function(){return this.deferred().promise()},e.prototype.register=function(t,e){return null==this._registry&&(this._registry={}),this._registry[e]=t},e.prototype.unregister=function(t,e){return delete this._registry[e]},e.prototype.resetRegistry=function(){var t,e,r,n,o;r=this.getRegistrySize(),n=this._registry;for(t in n)o=n[t],o.region.close();return e="There were "+r+" responders in the registry, there are now "+this.getRegistrySize(),this.getRegistrySize()>0?console.warn(e,this._registry):console.log(e)},e.prototype.getRegistrySize=function(){return g._.size(this._registry)},e}(xt);var Lt,Et=Vt,zt=function(t,e){function r(){this.constructor=t}for(var n in e)St.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},St={}.hasOwnProperty;Lt=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return zt(e,t),e.prototype.responders=function(){return{base:Et}},e.prototype.models=function(){return{base:xt}},e.prototype.collections=function(){return{base:Bt}},e.prototype.views=function(){return{}},e.prototype.getResponder=function(t,e){return null==e&&(e={}),this.getResource("responders",t,e)},e.prototype.getView=function(t,e){return null==e&&(e={}),this.getResource("views",t,e)},e.prototype.getModel=function(t,e){return null==e&&(e={}),this.getResource("models",t,e)},e.prototype.getCollection=function(t,e,r){return null==e&&(e=[]),null==r&&(r={}),this.getResource("collections",t,r,e)},e.prototype.getResource=function(t,e,r,n){var o,i;return null==r&&(r={}),o=null,i=this[t],g._.isFunction(i)&&(i=i()),null==r.viewModel&&(r.viewModel=this),g._.isObject(i)&&null!=i[e]&&(o=null!=n?new i[e](n,r):new i[e](r)),o},e}(o.Model);var Dt,Ht=Lt,It=function(t,e){function r(){this.constructor=t}for(var n in e)Nt.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},Nt={}.hasOwnProperty;Dt=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return It(e,t),e.prototype.navigateTo=function(t,e){return null==e&&(e={}),g.location.navigateTo(t,e)},e.prototype.getCurrentRoute=function(){return g.location.getCurrentRoute()},e}(g.Object);var $t=Dt,Yt=function(t,e){function r(){this.constructor=t}for(var n in e)Gt.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},Gt={}.hasOwnProperty;return g.channels=new R,g.location=new x,g.env=new m,g.config=new q,g.logger=new $,g._.extend(g.Renderer,L),g.utils=new D,g.AppRoute=W,g.AppRouter=Z,g._.extend(g.Region.prototype,nt.prototype),g.Views=new ct,g._.extend(g.View.prototype,{templateHelpers:function(){var t;return t=g.Views.templateHelpers,null!=this.viewContext?(t.viewContext=this.viewContext,g._.isFunction(this.viewContext)&&(t.viewContext=this.viewContext())):t.viewContext={},t}}),g.Views.Collection=ft,g.Views.Composite=gt,g.Views.Item=mt,g.Views.Layout=Rt,g.Entities=new g.Object,g.Entities.Models=new g.Object,g.Entities.Collections=new g.Object,g.Entities.ViewModels=new g.Object,g.Entities.Responders=new g.Object,g.Entities.Models.Base=xt,g.Backbone.AssociatedModel&&(g.Entities.Models.Associated=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return Yt(e,t),e}(g.Backbone.AssociatedModel)),g.Entities.Collections.Base=Bt,g.Entities.Responders.Base=Et,g.Entities.ViewModels.Base=Ht,g.Controllers=new g.Object,g.Controllers.Base=$t,g.Application=g.Application.extend({Controllers:new g.Object,Entities:new g.Object,Views:new g.Object,startHistory:function(t){return null==t&&(t={}),g.location.startHistory(t)},register:function(t,e){return null==this._registry&&(this._registry={}),this._registry[e]=t},unregister:function(t,e){return delete this._registry[e]},resetRegistry:function(){var t,e,r,n,o;n=this.getRegistrySize(),o=this._registry;for(e in o)t=o[e],t.region.close();return r="There were "+n+" controllers in the registry, there are now "+this.getRegistrySize(),this.getRegistrySize()>0?console.warn(r,this._registry):console.log(r)},getRegistrySize:function(){return g._.size(this._registry)}}),"undefined"!=typeof global&&null!==global&&(global.Marionettist=g),g});