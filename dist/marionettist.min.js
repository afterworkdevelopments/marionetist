!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("underscore"),require("underscore-contrib"),require("underscore.string"),require("jquery"),require("backbone"),require("backbone.radio"),require("backbone-associations"),require("backbone.marionette"),require("i18next"),require("numeral"),require("moment"),require("moment-range"),require("moment-timezone")):"function"==typeof define&&define.amd?define(["underscore","underscore-contrib","underscore.string","jquery","backbone","backbone.radio","backbone-associations","backbone.marionette","i18next","numeral","moment","moment-range","moment-timezone"],e):t.Marionettist=e(t._,t.underscoreContrib,t.s,t.$,t.Backbone,t.Backbone.Radio,t.backboneAssociations,t.Marionette,t.i18next,t.numeral,t.moment,t.momentRange,t.momentTimezone)}(this,function(t,e,r,n,o,i,u,c,p,s,l,a,f){"use strict";t="default"in t?t["default"]:t,r="default"in r?r["default"]:r,n="default"in n?n["default"]:n,o="default"in o?o["default"]:o,c="default"in c?c["default"]:c,p="default"in p?p["default"]:p,s="default"in s?s["default"]:s,l="default"in l?l["default"]:l;var y;y=c.extend(),y.Backbone=o,y.Marionette=c,y._=t,y.$=n,y.s=r,y.I18n=p,y.numeral=s,y.moment=l;var h,d=y,g=function(t,e){function r(){this.constructor=t}for(var n in e)w.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},w={}.hasOwnProperty;h=function(t){function e(){this.stage="development"}return g(e,t),e.prototype.current=function(){return this._current||(this._current=new e)},e.prototype.isDevelopment=function(){return"development"===this.stage},e.prototype.isProduction=function(){return"production"===this.stage},e.prototype.getLocale=function(){return d.I18n.language},e.prototype.setLocale=function(t,e){var r;return null==t&&(t="en"),null==e&&(e=null),r=this.getLocale(),d.I18n.changeLanguage(t,function(n){return d.channels.publish("marionettist","change:locale",{currentLocale:t,oldLocale:r}),d._.isFunction(e)?e(n):void 0})},e}(d.Object);var b,v=h,m=function(t,e){function r(){this.constructor=t}for(var n in e)O.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},O={}.hasOwnProperty;b=function(t){function e(){}return m(e,t),e.prototype.request=function(t,e,r){return null==t&&(t="global"),null==e&&(e=""),null==r&&(r={}),d.Backbone.Radio.channel(t).request(e,r)},e.prototype.replyOnce=function(t,e,r){var n;return null==t&&(t="global"),null==e&&(e=""),n=d.Backbone.Radio.channel(t),d._.isFunction(r)?n.replyOnce(e,r):n.replyOnce(r)},e.prototype.reply=function(t,e,r){var n;return null==t&&(t="global"),null==e&&(e=""),n=d.Backbone.Radio.channel(t),d._.isFunction(r)?n.reply(e,r):n.reply(r)},e.prototype.publish=function(t,e,r){return null==t&&(t="global"),null==e&&(e=""),null==r&&(r={}),d.Backbone.Radio.channel(t).trigger(e,r)},e.prototype.subscribe=function(t,e,r){return null==t&&(t="global"),null==e&&(e=""),d.Backbone.Radio.channel(t).on(e,r)},e}(d.Object);var k,R=b,P=function(t,e){function r(){this.constructor=t}for(var n in e)x.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},x={}.hasOwnProperty;k=function(t){function e(){}return P(e,t),e.prototype.refreshRoute=function(t){return null==t&&(t=this.getCurrentRoute()),d.Backbone.history.loadUrl(t)},e.prototype.navigateTo=function(t,e){return null==e&&(e={}),d.Backbone.history.navigate(t,e)},e.prototype.getCurrentRoute=function(){var t;return t=d.Backbone.history.fragment,d._.isEmpty(t)?null:t},e.prototype.startHistory=function(t){return null==t&&(t={}),null!=d.Backbone.history?d.Backbone.history.start(t):void 0},e}(d.Object);var F,M=k;F=function(){function t(){}return t.prototype.debug=!1,t.prototype.lookupPaths=[],t.prototype.engine=function(){var t;return t={},"undefined"!=typeof HAML&&null!==HAML&&(t=HAML),"undefined"!=typeof JST&&null!==JST&&(t=JST),t},t}();var C,j=F,B=function(t,e){function r(){this.constructor=t}for(var n in e)q.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},q={}.hasOwnProperty;C=function(t){function e(){this.templates=new j}return B(e,t),e}(d.Object);var A,T=C;A={render:function(t,e){var r;if(Marionettist._.isFunction(t))return t(e);if(t!==!1){if(r=this.getTemplate(t),!Marionettist._.isFunction(r))throw"Template "+t+" was not found!";return r(e)}},getTemplate:function(t){var e,r,n,o,i,u,c,p,s;if(c=Marionettist.config.templates.lookupPaths,Marionettist._.isFunction(c)&&(c=c()),!Marionettist._.isArray(c))throw"lookupPaths most be an array";for(s=[t,this.withTemplate(t)],0===c.length&&(c=[""]),e=0,n=c.length;n>e;e++)for(i=c[e],r=0,o=s.length;o>r;r++)if(p=s[r],u=this.findLookupPath(i+p,t),null!=u)return u},findLookupPath:function(t,e){var r,n;return r=Marionettist.config.templates.engine,Marionettist._.isFunction(r)&&(r=r()),n=r[t],Marionettist.config.templates.debug===!0&&Marionettist.logger.info("Looking template: "+e+" in '"+t+"'"),n?n:void 0},withTemplate:function(t){var e;return null!=t?(e=t.split("/"),e.splice(-1,0,"templates"),e.join("/")):void 0}};var L,V=A,H=function(t,e){function r(){this.constructor=t}for(var n in e)E.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},E={}.hasOwnProperty;L=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return H(e,t),e.prototype.pathFor=function(t){return t="",t="#"+t},e.prototype.waitFor=function(t,e){var r,n;return null==e&&(e={}),n=[],n=_.chain([t]).flatten().value(),(r=d.$).when.apply(r,n).then(function(){return d._.isFunction(e.success)?e.success():void 0},function(t){return d._.isFunction(e.error)?e.error():void 0})},e}(d.Object);var D,z=L,S=function(t,e){function r(){this.constructor=t}for(var n in e)I.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},I={}.hasOwnProperty;D=function(t){function e(){}return S(e,t),e.prototype.success=function(t,e){return null==e&&(e=!1),this.log(t,"success",e)},e.prototype.warn=function(t,e){return null==e&&(e=!1),this.log(t,"warn",e)},e.prototype.error=function(t,e){return null==e&&(e=!1),this.log(t,"error",e)},e.prototype.info=function(t,e){return null==e&&(e=!1),this.log(t,"info",e)},e.prototype.log=function(t,e,r){var n;if(null==r&&(r=!1),d.env.current().isDevelopment()||r===!0){switch(e=e||"black",n="White",e){case"success":e="Green",n="LimeGreen";break;case"info":e="DodgerBlue",n="Turquoise";break;case"error":e="Red",n="Black";break;case"start":e="OliveDrab",n="PaleGreen";break;case"warning":e="Tomato",n="Black";break;case"end":e="Orchid",n="MediumVioletRed";break;default:e=e}n="White","object"==typeof t?console.log(t):console.log("%c"+t,"color:"+e+";font-weight:bold; background-color: "+n+";")}},e}(d.Object);var N,Y=D,$=function(t,e){function r(){this.constructor=t}for(var n in e)G.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},G={}.hasOwnProperty;N=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return $(e,t),e.prototype.router=function(){return this.getOption("router")},e.prototype.path=function(){return this.getOption("path")},e.prototype.actionName=function(){return this.getOption("actionName")},e.prototype.controller=function(){return this.getOption("controller")},e}(d.Object);var J,W=N,U=function(t,e){function r(){this.constructor=t}for(var n in e)K.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},K={}.hasOwnProperty;J=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return U(e,t),e.prototype.onRoute=function(t,e,r){return null!=this.controller&&d._.isFunction(this.controller.onRoute)?this.controller.onRoute(this,t,e,r):void 0},e.prototype._setControllerFilters=function(t){var e,r;return null!=t&&(e={before:{},after:{}},r=t.filters,d._.isFunction(r)&&(r=r()),null==t.filters&&(t.filters={}),t.filters=d._.extend(e,r)),t},e.prototype._addAppRoute=function(t,e,r){var n,o;if(this.controller=this._setControllerFilters(t),n=t[r],o=function(t){return function(n){var o;return t.controller.route=new d.AppRoute({controller:t.controller,actionName:r,path:e}),o=t._executeFilter(t.controller.filters.before,t.controller),o!==!1?(t.controller[r].apply(t.controller,t._getParams()),t._executeFilter(t.controller.filters.after,t.controller)):void 0}}(this),!o)throw new d.Marionette.Error('Method "'+r+'" was not found on the controller');return this.route(e,r,d._.bind(o,t))},e.prototype._executeFilter=function(t,e){var r,n,o,i,u,c,p;for(c=!0,u=d._.keys(t),n=0,o=u.length;o>n;n++)switch(i=u[n],r=t[i],p="Action halted by filter '"+i+"'",!1){case!d._.isFunction(r):if(c=r(e),c===!1){"undefined"!=typeof console&&null!==console&&console.warn(p);break}break;case!d._.isObject(r):if(c=this._proccessFilterObject(i,r,e),c===!1){"undefined"!=typeof console&&null!==console&&console.warn(p);break}}return c},e.prototype._getParams=function(){var t,e;return e=this._routeToRegExp(this.controller.route.getOption("path")),t=this._extractParameters(e,d.Backbone.history.getFragment())},e.prototype._proccessFilterObject=function(t,e,r){var n,o,i,u;if(i={method:null,only:[],except:[]},u=d._.extend(i,e),o=r[t],n=r.route.actionName(),!_.isArray(u.only))throw"filter option only, most be an array";if(!_.isArray(u.except))throw"filter option except, most be an array";if(u.only.length>0||u.except.length>0){if(d._.contains(u.only,n)&&!d._.contains(u.except,n)&&d._.isFunction(o))return o.apply(this.controller,this._getParams())}else if(d._.isFunction(o))return o.apply(this.controller,this._getParams())},e}(d.AppRouter);var Q,X,Z=J,tt=function(t,e){function r(){this.constructor=t}for(var n in e)et.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},et={}.hasOwnProperty;X=c.Region.prototype.show,Q=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return tt(e,t),e.prototype.show=function(t,e){var r,n;return e=e||{},r=this.currentView,n=function(n){return function(){var o;return o=[t,d._.extend(e,{preventDestroy:!0})],X.apply(n,o),e.preventDestroy?void 0:r.destroy()}}(this),null!=r&&d._.isFunction(r.onHide)?r.onHide(n,this):n()},e}(c.Region);var rt,nt=Q,ot=function(t,e){function r(){this.constructor=t}for(var n in e)it.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},it={}.hasOwnProperty,ut=[].slice;rt=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return ot(e,t),e.prototype.templateHelpers={pathFor:function(){var t,e;return t=1<=arguments.length?ut.call(arguments,0):[],(e=d.utils).pathFor.apply(e,t)},t:function(){var t,e;return t=1<=arguments.length?ut.call(arguments,0):[],(e=d.I18n).t.apply(e,t)},formatCurrency:function(t,e){return null==e&&(e="$0,0.00"),d.numeral(t).format(e)},formatNumber:function(t,e){return null==e&&(e="0,0.00"),d.numeral(t).format(e)},formatPercentage:function(t,e){return null==e&&(e="0.00%"),d.numeral(t).format(e)},formatDate:function(t,e){return null==e&&(e="DD-MM-YYYY"),d.moment(t).format(e)}},e}(d.Object);var ct,pt=rt,st=function(t,e){function r(){this.constructor=t}for(var n in e)lt.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},lt={}.hasOwnProperty;ct=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return st(e,t),e}(c.CollectionView);var at,ft=ct,yt=function(t,e){function r(){this.constructor=t}for(var n in e)_t.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},_t={}.hasOwnProperty;at=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return yt(e,t),e}(c.CompositeView);var ht,dt=at,gt=function(t,e){function r(){this.constructor=t}for(var n in e)wt.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},wt={}.hasOwnProperty;ht=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return gt(e,t),e}(c.ItemView);var bt,vt=ht,mt=function(t,e){function r(){this.constructor=t}for(var n in e)Ot.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},Ot={}.hasOwnProperty;bt=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return mt(e,t),e}(c.LayoutView);var kt,Rt=bt,Pt=function(t,e){function r(){this.constructor=t}for(var n in e)xt.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},xt={}.hasOwnProperty;kt=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return Pt(e,t),e}(o.Model);var Ft,Mt=kt,Ct=function(t,e){function r(){this.constructor=t}for(var n in e)jt.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},jt={}.hasOwnProperty;Ft=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return Ct(e,t),e}(o.Collection);var Bt,qt=Ft,At=function(t,e){function r(){this.constructor=t}for(var n in e)Tt.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},Tt={}.hasOwnProperty;Bt=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return At(e,t),e.prototype.navigateTo=function(t,e){return null==e&&(e={}),d.location.navigateTo(t,e)},e.prototype.getCurrentRoute=function(){return d.location.getCurrentRoute()},e}(d.Object);var Lt=Bt,Vt=function(t,e){function r(){this.constructor=t}for(var n in e)Ht.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},Ht={}.hasOwnProperty;return d.channels=new R,d.location=new M,d.env=new v,d.config=new T,d.logger=new Y,d._.extend(d.Renderer,V),d.utils=new z,d.AppRoute=W,d.AppRouter=Z,d.Region=nt,d.Views=new pt,d._.extend(d.View.prototype,{templateHelpers:function(){var t;return t=d.Views.templateHelpers,null!=this.viewContext?(t.viewContext=this.viewContext,d._.isFunction(this.viewContext)&&(t.viewContext=this.viewContext())):t.viewContext={},t}}),d.Views.Collection=ft,d.Views.Composite=dt,d.Views.Item=vt,d.Views.Layout=Rt,d.Entities=new d.Object,d.Entities.Models=new d.Object,d.Entities.Collections=new d.Object,d.Entities.Models.Base=Mt,d.Backbone.AssociatedModel&&(d.Entities.Models.Associated=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return Vt(e,t),e}(d.Backbone.AssociatedModel)),d.Entities.Collections.Base=qt,d.Controllers=new d.Object,d.Controllers.Base=Lt,d.Application=d.Application.extend({Controllers:new d.Object,Entities:new d.Object,Views:new d.Object,startHistory:function(t){return null==t&&(t={}),d.location.startHistory(t)},register:function(t,e){return null==this._registry&&(this._registry={}),this._registry[e]=t},unregister:function(t,e){return delete this._registry[e]},resetRegistry:function(){var t,e,r,n,o;n=this.getRegistrySize(),o=this._registry;for(e in o)t=o[e],t.region.close();return r="There were "+n+" controllers in the registry, there are now "+this.getRegistrySize(),this.getRegistrySize()>0?console.warn(r,this._registry):console.log(r)},getRegistrySize:function(){return d._.size(this._registry)}}),"undefined"!=typeof global&&null!==global&&(global.Marionettist=d),d});