!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("underscore"),require("underscore-contrib"),require("underscore.string"),require("jquery"),require("backbone"),require("backbone.radio"),require("backbone-associations"),require("backbone.marionette"),require("i18next"),require("numeral"),require("moment"),require("moment-range"),require("moment-timezone")):"function"==typeof define&&define.amd?define(["underscore","underscore-contrib","underscore.string","jquery","backbone","backbone.radio","backbone-associations","backbone.marionette","i18next","numeral","moment","moment-range","moment-timezone"],e):t.Marionettist=e(t._,t.underscoreContrib,t.s,t.$,t.Backbone,t.backbone_radio,t.backboneAssociations,t.Marionette,t.i18next,t.numeral,t.moment,t.momentRange,t.momentTimezone)}(this,function(t,e,n,r,o,i,u,l,s,a,c,p,f){"use strict";t="default"in t?t["default"]:t,n="default"in n?n["default"]:n,r="default"in r?r["default"]:r,o="default"in o?o["default"]:o,l="default"in l?l["default"]:l,s="default"in s?s["default"]:s,a="default"in a?a["default"]:a,c="default"in c?c["default"]:c;var h;h=function(){function t(){this.stage="development"}return t.current=function(){return this._current||(this._current=new t)},t.prototype.isDevelopment=function(){return"development"===this.stage},t.prototype.isProduction=function(){return"production"===this.stage},t.prototype.getLocale=function(){return Marionettist.I18n.language},t.prototype.setLocale=function(t,e){var n;return null==t&&(t="en"),null==e&&(e=null),n=this.getLocale(),Marionettist.I18n.changeLanguage(t,function(r){return Marionettist.channels.publish("marionettist","change:locale",{currentLocale:t,oldLocale:n}),Marionettist._.isFunction(e)?e(r):void 0})},t}();var y,d=h;y=function(){function t(){}return t.prototype.request=function(t,e,n){return null==t&&(t="global"),null==e&&(e=""),null==n&&(n={}),Marionettist.Backbone.Radio.channel(t).request(e,n)},t.prototype.replyOnce=function(t,e,n){var r;return null==t&&(t="global"),null==e&&(e=""),r=Marionettist.Backbone.Radio.channel(t),Marionettist._.isFunction(n)?r.replyOnce(e,n):r.replyOnce(n)},t.prototype.reply=function(t,e,n){var r;return null==t&&(t="global"),null==e&&(e=""),r=Marionettist.Backbone.Radio.channel(t),Marionettist._.isFunction(n)?r.reply(e,n):r.reply(n)},t.prototype.publish=function(t,e,n){return null==t&&(t="global"),null==e&&(e=""),null==n&&(n={}),Marionettist.Backbone.Radio.channel(t).trigger(e,n)},t.prototype.subscribe=function(t,e,n){return null==t&&(t="global"),null==e&&(e=""),Marionettist.Backbone.Radio.channel(t).on(e,n)},t}();var _,m=y;_=function(){function t(){}return t.prototype.refreshRoute=function(t){return null==t&&(t=this.getCurrentRoute()),Marionettist.Backbone.history.loadUrl(t)},t.prototype.navigateTo=function(t,e){return null==e&&(e={}),Marionettist.Backbone.history.navigate(t,e)},t.prototype.getCurrentRoute=function(){var t;return t=Marionettist.Backbone.history.fragment,Marionettist._.isEmpty(t)?null:t},t.prototype.startHistory=function(t){return null==t&&(t={}),null!=Marionettist.Backbone.history?Marionettist.Backbone.history.start(t):void 0},t}();var g,b=_;g=function(){function t(){}return t.prototype.lookupPaths=["templates/"],t.prototype.engine=function(){var t;return t={},"undefined"!=typeof HAML&&null!==HAML&&(t=HAML),"undefined"!=typeof JST&&null!==JST&&(t=JST),t},t}();var w,v=g;w=function(){function t(){this.templates=new v}return t}();var k,M,R=w,x=function(t,e){function n(){this.constructor=t}for(var r in e)C.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},C={}.hasOwnProperty;k=l.extend(),k.Backbone=o,k.Marionette=l,k._=t,k.$=r,k.s=n,k.I18n=s,k.numeral=a,k.moment=c,k.channels=new m,k.location=new b,k.env=new d,k.config=new R,k._.extend(k.Renderer,{render:function(e,n){var r;if(t.isFunction(e))return e(n);if(e!==!1){if(r=this.getTemplate(e),!r)throw"Template "+e+" not found!";return r(n)}},getTemplate:function(e){var n,r,o,i,u,l,s,a,c;if(s=k.config.templates.lookupPaths,t.isFunction(s)&&(s=s()),!t.isArray(s))throw"lookupPaths most be an array";for(r=0,i=s.length;i>r;r++)for(l=s[r],c=[e,this.withTemplate(e)],o=0,u=c.length;u>o;o++)if(a=c[o],n=k.config.templates.engine,t.isFunction(n)&&(n=n()),n[l+a])return n[l+a]},withTemplate:function(t){var e;return null!=t?(e=t.split("/"),e.splice(-1,0,"templates"),e.join("/")):void 0}}),k.Utils=k._.extend(new k.Object,{log:function(t,e){var n;if(k.env.current().isDevelopment()){switch(e=e||"black",n="White",e){case"success":e="Green",n="LimeGreen";break;case"info":e="DodgerBlue",n="Turquoise";break;case"error":e="Red",n="Black";break;case"start":e="OliveDrab",n="PaleGreen";break;case"warning":e="Tomato",n="Black";break;case"end":e="Orchid",n="MediumVioletRed";break;default:e=e}n="White","object"==typeof t?console.log(t):console.log("%c"+t,"color:"+e+";font-weight:bold; background-color: "+n+";")}},waitFor:function(e,n){var r,o;return null==n&&(n={}),o=[],o=t.chain([e]).flatten().value(),(r=k.$).when.apply(r,o).then(function(){return k._.isFunction(n.success)?n.success():void 0},function(t){return k._.isFunction(n.error)?n.error():void 0})}}),k.AppRoute=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return x(e,t),e.prototype.router=function(){return this.getOption("router")},e.prototype.path=function(){return this.getOption("path")},e.prototype.actionName=function(){return this.getOption("actionName")},e.prototype.controller=function(){return this.getOption("controller")},e}(k.Object),k.AppRouter=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return x(n,e),n.prototype.onRoute=function(e,n,r){return null!=this.controller&&t.isFunction(this.controller.onRoute)?this.controller.onRoute(this,e,n,r):void 0},n.prototype._setControllerFilters=function(t){var e,n;return null!=t&&(e={before:{},after:{}},n=t.filters,k._.isFunction(n)&&(n=n()),null==t.filters&&(t.filters={}),t.filters=k._.extend(e,n)),t},n.prototype._addAppRoute=function(e,n,r){var o,i;if(this.controller=this._setControllerFilters(e),o=e[r],i=function(t){return function(e){var o;return t.controller.route=new k.AppRoute({controller:t.controller,actionName:r,path:n}),o=t._executeFilter(t.controller.filters.before,t.controller),o!==!1?(t.controller[r].apply(t.controller,t._getParams()),t._executeFilter(t.controller.filters.after,t.controller)):void 0}}(this),!i)throw new k.Marionette.Error('Method "'+r+'" was not found on the controller');return this.route(n,r,t.bind(i,e))},n.prototype._executeFilter=function(e,n){var r,o,i,u,l,s,a;for(s=!0,l=t.keys(e),o=0,i=l.length;i>o;o++)switch(u=l[o],r=e[u],a="Action halted by filter '"+u+"'",!1){case!k._.isFunction(r):if(s=r(n),s===!1){"undefined"!=typeof console&&null!==console&&console.warn(a);break}break;case!k._.isObject(r):if(s=this._proccessFilterObject(u,r,n),s===!1){"undefined"!=typeof console&&null!==console&&console.warn(a);break}}return s},n.prototype._getParams=function(){var t,e;return e=this._routeToRegExp(this.controller.route.getOption("path")),t=this._extractParameters(e,o.history.getFragment())},n.prototype._proccessFilterObject=function(e,n,r){var o,i,u,l;if(u={method:null,only:[],except:[]},l=k._.extend(u,n),i=r[e],o=r.route.actionName(),!t.isArray(l.only))throw"filter option only, most be an array";if(!t.isArray(l.except))throw"filter option except, most be an array";if(l.only.length>0||l.except.length>0){if(k._.contains(l.only,o)&&!k._.contains(l.except,o)&&k._.isFunction(i))return i.apply(this.controller,this._getParams())}else if(k._.isFunction(i))return i.apply(this.controller,this._getParams())},n}(k.Marionette.AppRouter),M=k.Marionette.Region.prototype.show,k.Region=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return x(e,t),e.prototype.show=function(t,e){var n,r;return e=e||{},n=this.currentView,r=function(r){return function(){var o;return o=[t,k._.extend(e,{preventDestroy:!0})],M.apply(r,o),e.preventDestroy?void 0:n.destroy()}}(this),null!=n&&k._.isFunction(n.onHide)?n.onHide(r,this):r()},e}(k.Marionette.Region),k.Views=new k.Object,k.Views.templateHelpers={t:k.I18n.t,formatCurrency:function(t,e){return null==e&&(e="$0,0.00"),k.numeral(t).format(e)},formatNumber:function(t,e){return null==e&&(e="0,0.00"),k.numeral(t).format(e)},formatPercentage:function(t,e){return null==e&&(e="0.00%"),k.numeral(t).format(e)},formatDate:function(t,e){return null==e&&(e="DD-MM-YYYY"),k.moment(t).format(e)}},k._.extend(k.View.prototype,{templateHelpers:function(){var t;return t=k.Views.templateHelpers,null!=this.viewContext?(t.viewContext=this.viewContext,k._.isFunction(this.viewContext)&&(t.viewContext=this.viewContext())):t.viewContext={},t}}),k.Views.Collection=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return x(e,t),e}(k.Marionette.CollectionView),k.Views.Composite=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return x(e,t),e}(k.Marionette.CompositeView),k.Views.Item=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return x(e,t),e}(k.Marionette.ItemView),k.Views.Layout=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return x(e,t),e}(k.Marionette.LayoutView),k.Entities=new k.Object,k.Entities.Models=new k.Object,k.Entities.Collections=new k.Object,k.Entities.Models.Base=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return x(e,t),e}(k.Backbone.Model),k.Backbone.AssociatedModel&&(k.Entities.Models.Associated=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return x(e,t),e}(k.Backbone.AssociatedModel)),k.Entities.Collections.Base=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return x(e,t),e}(k.Backbone.Collection),k.Controllers=new k.Object,k.Controllers.Base=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return x(e,t),e}(k.Object),k.Application=k.Application.extend({Backbone:k.Backbone,Marionette:k.Marionette,_:k._,$:k.$,s:k.s,I18n:k.I18n,numeral:k.numeral,moment:k.moment,Controllers:new k.Object,Entities:new k.Object,Views:new k.Object,navigateTo:function(t,e){return null==e&&(e={}),k.location.navigateTo(t,e)},getCurrentRoute:function(){return k.location.getCurrentRoute()},startHistory:function(t){return null==t&&(t={}),k.location.startHistory(t)},register:function(t,e){return null==this._registry&&(this._registry={}),this._registry[e]=t},unregister:function(t,e){return delete this._registry[e]},resetRegistry:function(){var t,e,n,r,o;r=this.getRegistrySize(),o=this._registry;for(e in o)t=o[e],t.region.close();return n="There were "+r+" controllers in the registry, there are now "+this.getRegistrySize(),this.getRegistrySize()>0?console.warn(n,this._registry):console.log(n)},getRegistrySize:function(){return k._.size(this._registry)}});var O=k;return O});