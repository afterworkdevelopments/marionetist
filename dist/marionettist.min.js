!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("underscore"),require("underscore-contrib"),require("underscore.string"),require("jquery"),require("backbone"),require("backbone.radio"),require("backbone-associations"),require("backbone.marionette"),require("i18next"),require("numeral"),require("moment"),require("moment-range"),require("moment-timezone")):"function"==typeof define&&define.amd?define(["underscore","underscore-contrib","underscore.string","jquery","backbone","backbone.radio","backbone-associations","backbone.marionette","i18next","numeral","moment","moment-range","moment-timezone"],e):t.Marionettist=e(t._,t.underscoreContrib,t.s,t.$,t.Backbone,t.Backbone.Radio,t.backboneAssociations,t.Marionette,t.i18next,t.numeral,t.moment,t.momentRange,t.momentTimezone)}(this,function(t,e,r,n,o,i,u,c,p,s,l,a,f){"use strict";t="default"in t?t["default"]:t,r="default"in r?r["default"]:r,n="default"in n?n["default"]:n,o="default"in o?o["default"]:o,c="default"in c?c["default"]:c,p="default"in p?p["default"]:p,s="default"in s?s["default"]:s,l="default"in l?l["default"]:l;var y;y=c.extend(),y.Backbone=o,y.Marionette=c,y._=t,y.$=n,y.s=r,y.I18n=p,y.numeral=s,y.moment=l;var h,g=y,d=function(t,e){function r(){this.constructor=t}for(var n in e)w.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},w={}.hasOwnProperty;h=function(t){function e(){this.stage="development"}return d(e,t),e.prototype.isDevelopment=function(){return"development"===this.stage},e.prototype.isProduction=function(){return"production"===this.stage},e.prototype.getLocale=function(){return g.I18n.language},e.prototype.setStage=function(t){var e;return e=this.stage,this.stage=t,this.triggerMethod("change:stage",e,t)},e.prototype.getStage=function(){return this.stage},e.prototype.setLocale=function(t,e){var r;return null==t&&(t="en"),null==e&&(e=null),r=this.getLocale(),g.I18n.changeLanguage(t,function(n){return g.channels.publish("marionettist","change:locale",{currentLocale:t,oldLocale:r}),g._.isFunction(e)?e(n):void 0})},e}(g.Object);var b,v=h,m=function(t,e){function r(){this.constructor=t}for(var n in e)O.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},O={}.hasOwnProperty;b=function(t){function e(){}return m(e,t),e.prototype.request=function(t,e,r){return null==t&&(t="global"),null==e&&(e=""),null==r&&(r={}),g.Backbone.Radio.channel(t).request(e,r)},e.prototype.replyOnce=function(t,e,r){var n;return null==t&&(t="global"),null==e&&(e=""),n=g.Backbone.Radio.channel(t),g._.isFunction(r)?n.replyOnce(e,r):n.replyOnce(r)},e.prototype.reply=function(t,e,r){var n;return null==t&&(t="global"),null==e&&(e=""),n=g.Backbone.Radio.channel(t),g._.isFunction(r)?n.reply(e,r):n.reply(r)},e.prototype.publish=function(t,e,r){return null==t&&(t="global"),null==e&&(e=""),null==r&&(r={}),g.Backbone.Radio.channel(t).trigger(e,r)},e.prototype.subscribe=function(t,e,r){return null==t&&(t="global"),null==e&&(e=""),g.Backbone.Radio.channel(t).on(e,r)},e}(g.Object);var k,R=b,P=function(t,e){function r(){this.constructor=t}for(var n in e)x.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},x={}.hasOwnProperty;k=function(t){function e(){}return P(e,t),e.prototype.refreshRoute=function(t){return null==t&&(t=this.getCurrentRoute()),g.Backbone.history.loadUrl(t)},e.prototype.navigateTo=function(t,e){return null==e&&(e={}),g.Backbone.history.navigate(t,e)},e.prototype.getCurrentRoute=function(){var t;return t=g.Backbone.history.fragment,g._.isEmpty(t)?null:t},e.prototype.startHistory=function(t){return null==t&&(t={}),null!=g.Backbone.history?g.Backbone.history.start(t):void 0},e}(g.Object);var M,F=k;M=function(){function t(){}return t.prototype.debug=!1,t.prototype.lookupPaths=[],t.prototype.engine=function(){var t;return t={},"undefined"!=typeof HAML&&null!==HAML&&(t=HAML),"undefined"!=typeof JST&&null!==JST&&(t=JST),t},t}();var C,j=M,B=function(t,e){function r(){this.constructor=t}for(var n in e)q.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},q={}.hasOwnProperty;C=function(t){function e(){this.templates=new j}return B(e,t),e}(g.Object);var A,L=C;A={render:function(t,e){var r;if(Marionettist._.isFunction(t))return t(e);if(t!==!1){if(r=this.getTemplate(t),!Marionettist._.isFunction(r))throw"Template "+t+" was not found!";return r(e)}},getTemplate:function(t){var e,r,n,o,i,u,c,p,s;if(c=Marionettist.config.templates.lookupPaths,Marionettist._.isFunction(c)&&(c=c()),!Marionettist._.isArray(c))throw"lookupPaths most be an array";for(s=[t],0===c.length&&(c=[""]),e=0,n=c.length;n>e;e++)for(i=c[e],r=0,o=s.length;o>r;r++)if(p=s[r],u=this.findLookupPath(i+p,t),null!=u)return u},findLookupPath:function(t,e){var r,n;return r=Marionettist.config.templates.engine,Marionettist._.isFunction(r)&&(r=r()),n=r[t],Marionettist.config.templates.debug===!0&&Marionettist.logger.info("Looking template: "+e+" in '"+t+"'"),n?n:void 0},withTemplate:function(t){var e;return null!=t?(e=t.split("/"),e.splice(-1,0,"templates"),e.join("/")):void 0}};var T,V=A,E=function(t,e){function r(){this.constructor=t}for(var n in e)H.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},H={}.hasOwnProperty;T=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return E(e,t),e.prototype.pathFor=function(t){var e;return e="",e="#"+t},e.prototype.waitFor=function(t,e){var r,n;return null==e&&(e={}),n=[],n=_.chain([t]).flatten().value(),(r=g.$).when.apply(r,n).then(function(){return g._.isFunction(e.success)?e.success():void 0},function(t){return g._.isFunction(e.error)?e.error():void 0})},e}(g.Object);var D,S=T,z=function(t,e){function r(){this.constructor=t}for(var n in e)I.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},I={}.hasOwnProperty;D=function(t){function e(){}return z(e,t),e.prototype.success=function(t,e){return null==e&&(e={}),e.type="success",this.log(t,e)},e.prototype.warn=function(t,e){return null==e&&(e={}),e.type="warn",this.log(t,e)},e.prototype.error=function(t,e){return null==e&&(e={}),e.type="error",this.log(t,e)},e.prototype.info=function(t,e){return null==e&&(e={}),e.type="info",this.log(t,e)},e.prototype.log=function(t,e){var r,n,o;if(null==e&&(e={}),n=e.force,o=e.type,g.env.isDevelopment()||n===!0){switch(o=o||"black",r="White",o){case"success":o="Green",r="LimeGreen";break;case"info":o="DodgerBlue",r="Turquoise";break;case"error":o="Red",r="Black";break;case"start":o="OliveDrab",r="PaleGreen";break;case"warning":o="Tomato",r="Black";break;case"end":o="Orchid",r="MediumVioletRed";break;default:o=o}r="White","object"==typeof t?console.log(t):console.log("%c"+t,"type:"+o+";font-weight:bold; background-type: "+r+";")}},e}(g.Object);var N,Y=D,$=function(t,e){function r(){this.constructor=t}for(var n in e)G.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},G={}.hasOwnProperty;N=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return $(e,t),e.prototype.router=function(){return this.getOption("router")},e.prototype.path=function(){return this.getOption("path")},e.prototype.actionName=function(){return this.getOption("actionName")},e.prototype.controller=function(){return this.getOption("controller")},e}(g.Object);var J,W=N,U=function(t,e){function r(){this.constructor=t}for(var n in e)K.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},K={}.hasOwnProperty;J=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return U(e,t),e.prototype.onRoute=function(t,e,r){return null!=this.controller&&g._.isFunction(this.controller.onRoute)?this.controller.onRoute(this,t,e,r):void 0},e.prototype._setControllerFilters=function(t){var e,r;return null!=t&&(e={before:{},after:{}},r=t.filters,g._.isFunction(r)&&(r=r()),null==t.filters&&(t.filters={}),t.filters=g._.extend(e,r)),t},e.prototype._addAppRoute=function(t,e,r){var n,o;if(this.controller=this._setControllerFilters(t),n=t[r],o=function(t){return function(n){var o;return t.controller.route=new g.AppRoute({controller:t.controller,actionName:r,path:e}),o=t._executeFilter(t.controller.filters.before,t.controller),o!==!1?(t.controller[r].apply(t.controller,t._getParams()),t._executeFilter(t.controller.filters.after,t.controller)):void 0}}(this),!o)throw new g.Marionette.Error('Method "'+r+'" was not found on the controller');return this.route(e,r,g._.bind(o,t))},e.prototype._executeFilter=function(t,e){var r,n,o,i,u,c,p;for(c=!0,u=g._.keys(t),n=0,o=u.length;o>n;n++)switch(i=u[n],r=t[i],p="Action halted by filter '"+i+"'",!1){case!g._.isFunction(r):if(c=r(e),c===!1){"undefined"!=typeof console&&null!==console&&console.warn(p);break}break;case!g._.isObject(r):if(c=this._proccessFilterObject(i,r,e),c===!1){"undefined"!=typeof console&&null!==console&&console.warn(p);break}}return c},e.prototype._getParams=function(){var t,e;return e=this._routeToRegExp(this.controller.route.getOption("path")),t=this._extractParameters(e,g.Backbone.history.getFragment())},e.prototype._proccessFilterObject=function(t,e,r){var n,o,i,u;if(i={method:null,only:[],except:[]},u=g._.extend(i,e),o=r[t],n=r.route.actionName(),!_.isArray(u.only))throw"filter option only, most be an array";if(!_.isArray(u.except))throw"filter option except, most be an array";if(u.only.length>0||u.except.length>0){if(g._.contains(u.only,n)&&!g._.contains(u.except,n)&&g._.isFunction(o))return o.apply(this.controller,this._getParams())}else if(g._.isFunction(o))return o.apply(this.controller,this._getParams())},e}(g.AppRouter);var Q,X,Z=J,tt=function(t,e){function r(){this.constructor=t}for(var n in e)et.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},et={}.hasOwnProperty;X=c.Region.prototype.show,Q=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return tt(e,t),e.prototype.show=function(t,e){var r,n;return e=e||{},r=this.currentView,n=function(n){return function(){var o;return o=[t,g._.extend(e,{preventDestroy:!0})],X.apply(n,o),e.preventDestroy?void 0:r.destroy()}}(this),null!=r&&g._.isFunction(r.onHide)?(r.triggerMethod("before:hide",n,this),r.triggerMethod("hide",n,this)):n()},e}(c.Region);var rt,nt=Q,ot=function(t,e){function r(){this.constructor=t}for(var n in e)it.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},it={}.hasOwnProperty,ut=[].slice;rt=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return ot(e,t),e.prototype.templateHelpers={pathFor:function(){var t,e;return t=1<=arguments.length?ut.call(arguments,0):[],(e=g.utils).pathFor.apply(e,t)},t:function(){var t,e;return t=1<=arguments.length?ut.call(arguments,0):[],(e=g.I18n).t.apply(e,t)},formatCurrency:function(t,e){return null==e&&(e="$0,0.00"),g.numeral(t).format(e)},formatNumber:function(t,e){return null==e&&(e="0,0.00"),g.numeral(t).format(e)},formatPercentage:function(t,e){return null==e&&(e="0.00%"),g.numeral(t).format(e)},formatDate:function(t,e){return null==e&&(e="DD-MM-YYYY"),g.moment(t).format(e)}},e}(g.Object);var ct,pt=rt,st=function(t,e){function r(){this.constructor=t}for(var n in e)lt.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},lt={}.hasOwnProperty;ct=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return st(e,t),e}(c.CollectionView);var at,ft=ct,yt=function(t,e){function r(){this.constructor=t}for(var n in e)_t.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},_t={}.hasOwnProperty;at=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return yt(e,t),e}(c.CompositeView);var ht,gt=at,dt=function(t,e){function r(){this.constructor=t}for(var n in e)wt.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},wt={}.hasOwnProperty;ht=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return dt(e,t),e}(c.ItemView);var bt,vt=ht,mt=function(t,e){function r(){this.constructor=t}for(var n in e)Ot.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},Ot={}.hasOwnProperty;bt=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return mt(e,t),e}(c.LayoutView);var kt,Rt=bt,Pt=function(t,e){function r(){this.constructor=t}for(var n in e)xt.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},xt={}.hasOwnProperty;kt=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return Pt(e,t),e}(o.Model);var Mt,Ft=kt,Ct=function(t,e){function r(){this.constructor=t}for(var n in e)jt.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},jt={}.hasOwnProperty;Mt=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return Ct(e,t),e}(o.Collection);var Bt,qt=Mt,At=function(t,e){function r(){this.constructor=t}for(var n in e)Lt.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},Lt={}.hasOwnProperty;Bt=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return At(e,t),e.prototype.navigateTo=function(t,e){return null==e&&(e={}),g.location.navigateTo(t,e)},e.prototype.getCurrentRoute=function(){return g.location.getCurrentRoute()},e}(g.Object);var Tt=Bt,Vt=function(t,e){function r(){this.constructor=t}for(var n in e)Et.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},Et={}.hasOwnProperty;return g.channels=new R,g.location=new F,g.env=new v,g.config=new L,g.logger=new Y,g._.extend(g.Renderer,V),g.utils=new S,g.AppRoute=W,g.AppRouter=Z,g._.extend(g.Region.prototype,nt.prototype),g.Views=new pt,g._.extend(g.View.prototype,{templateHelpers:function(){var t;return t=g.Views.templateHelpers,null!=this.viewContext?(t.viewContext=this.viewContext,g._.isFunction(this.viewContext)&&(t.viewContext=this.viewContext())):t.viewContext={},t}}),g.Views.Collection=ft,g.Views.Composite=gt,g.Views.Item=vt,g.Views.Layout=Rt,g.Entities=new g.Object,g.Entities.Models=new g.Object,g.Entities.Collections=new g.Object,g.Entities.Models.Base=Ft,g.Backbone.AssociatedModel&&(g.Entities.Models.Associated=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return Vt(e,t),e}(g.Backbone.AssociatedModel)),g.Entities.Collections.Base=qt,g.Controllers=new g.Object,g.Controllers.Base=Tt,g.Application=g.Application.extend({Controllers:new g.Object,Entities:new g.Object,Views:new g.Object,startHistory:function(t){return null==t&&(t={}),g.location.startHistory(t)},register:function(t,e){return null==this._registry&&(this._registry={}),this._registry[e]=t},unregister:function(t,e){return delete this._registry[e]},resetRegistry:function(){var t,e,r,n,o;n=this.getRegistrySize(),o=this._registry;for(e in o)t=o[e],t.region.close();return r="There were "+n+" controllers in the registry, there are now "+this.getRegistrySize(),this.getRegistrySize()>0?console.warn(r,this._registry):console.log(r)},getRegistrySize:function(){return g._.size(this._registry)}}),"undefined"!=typeof global&&null!==global&&(global.Marionettist=g),g});