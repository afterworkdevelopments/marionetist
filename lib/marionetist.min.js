var extend=function(e,n){function t(){this.constructor=e}for(var o in n)hasProp.call(n,o)&&(e[o]=n[o]);return t.prototype=n.prototype,e.prototype=new t,e.__super__=n.prototype,e},hasProp={}.hasOwnProperty;!function(e,n){var t,o,r,i,l,s,u,a,c,f,p;if(e="object"==typeof self&&self.self===self&&self||"object"==typeof global&&global.global===global&&global,"function"==typeof define&&define.amd)return define(["underscore","jquery","backbone","backbone-associations","backbone.marionette","i18next-client","exports","underscore.string","numeral","moment","moment-range"],function(t,o,r,i,l,s,u,a,c,f,p){var d;d=n(e,u,r,l,t,o,s,a,c,f),e.Marionetist=d});if("undefined"!=typeof exports){l=require("underscore"),t=void 0,o=require("backbone"),i=require("backbone.marionette"),u=require("i18next-client"),p=require("underscore.string"),r=require("backbone-associations"),f=require("numeral"),a=require("moment"),c=require("moment-range");try{t=require("jquery")}catch(d){s=d}return module.exports=e.Marionetist=n(e,exports,o,i,l,t,u,p,f,a)}return e.Marionetist=n(e,{},e.Backbone,e.Marionette,e._,e.jQuery||e.Zepto||e.ender||e.$,e.i18n,e.s,e.numeral,e.moment)}(this,function(e,n,t,o,r,i,l,s,u,a){var c,f;return null==i&&"undefined"!=typeof console&&null!==console&&console.error("Unable to load jQuery"),null==r&&"undefined"!=typeof console&&null!==console&&console.error("Unable to load Underscore"),null==s&&"undefined"!=typeof console&&null!==console&&console.error("Unable to load Underscore.string"),null==t&&"undefined"!=typeof console&&null!==console&&console.error("Unable to load Backbone"),null==t.AssociatedModel&&"undefined"!=typeof console&&null!==console&&console.error("Unable to load backbone-associations"),null==o&&"undefined"!=typeof console&&null!==console&&console.error("Unable to load Marionette"),null==l&&"undefined"!=typeof console&&null!==console&&console.error("Unable to load i18next"),null==u&&"undefined"!=typeof console&&null!==console&&console.error("Unable to load numeral"),null==a&&"undefined"!=typeof console&&null!==console&&console.error("Unable to load moment"),null==a.range&&"undefined"!=typeof console&&null!==console&&console.error("Unable to load moment-range"),c=o.extend(),c.Backbone=t,c.Marionette=o,c._=r,c.$=i,c.s=s,c.I18n=l,c.numeral=u,c.moment=a,c.Config=new c.Object,f=function(n){function t(){return t.__super__.constructor.apply(this,arguments)}return extend(t,n),t.prototype.lookupPaths=["templates/"],t.prototype.engine=function(){var n;return n={},null!=e.HAML&&(n=HAML),null!=e.JST&&(n=JST),n},t}(c.Object),c.Config.options.templates=new f,r.extend(c.Renderer,{render:function(e,n){var t;if(r.isFunction(e))return e(n);if(e!==!1){if(t=this.getTemplate(e),!t)throw"Template "+e+" not found!";return t(n)}},getTemplate:function(e){var n,t,o,i,l,s,u,a,f;if(u=c.Config.getOption("templates").getOption("lookupPaths"),r.isFunction(u)&&(u=u()),!r.isArray(u))throw"lookupPaths most be an array";for(t=0,i=u.length;i>t;t++)for(s=u[t],f=[e,this.withTemplate(e)],o=0,l=f.length;l>o;o++)if(a=f[o],n=c.Config.getOption("templates").getOption("engine"),r.isFunction(n)&&(n=n()),n[s+a])return n[s+a]},withTemplate:function(e){var n;return null!=e?(n=e.split("/"),n.splice(-1,0,"templates"),n.join("/")):void 0}}),c.Views=new c.Object,c.Views.templateHelpers={t:c.I18n.t,formatCurrency:function(e,n){return null==n&&(n="$0,0.00"),c.numeral(e).format(n)},formatNumber:function(e,n){return null==n&&(n="0,0.00"),c.numeral(e).format(n)},formatPercentage:function(e,n){return null==n&&(n="0.00%"),c.numeral(e).format(n)},formatDate:function(e,n){return null==n&&(n="DD-MM-YYYY"),c.moment(e).format(n)}},r.extend(c.View.prototype,{templateHelpers:function(){return c.Views.templateHelpers}}),c.Views.Collection=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return extend(n,e),n}(o.CollectionView),c.Views.Composite=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return extend(n,e),n}(o.CompositeView),c.Views.Layout=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return extend(n,e),n}(o.LayoutView),c.Views.Item=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return extend(n,e),n}(o.ItemView),c.Entities=new c.Object,c.Entities.Models=new c.Object,c.Entities.Collections=new c.Object,c.Entities.Models.Base=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return extend(n,e),n}(t.Model),t.AssociatedModel&&(c.Entities.Models.Associated=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return extend(n,e),n}(t.AssociatedModel)),c.Entities.Collections.Base=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return extend(n,e),n}(t.Collection),c.Controllers=new c.Object,c.Controllers.Base=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return extend(n,e),n}(c.Object),c.Application=c.Application.extend({Backbone:c.Backbone,Marionette:c.Marionette,_:c._,$:c.$,s:c.s,I18n:c.I18n,numeral:c.numeral,moment:c.moment,Controllers:new c.Object,Entities:new c.Object,Views:new c.Object,navigate:function(e,n){return null==n&&(n={}),c.Backbone.history.navigate(e,n)},getCurrentRoute:function(){var e;return e=c.Backbone.history.fragment,r.isEmpty(e)?null:e},startHistory:function(e){return null==e&&(e={}),null!=c.Backbone.history?c.Backbone.history.start(e):void 0},register:function(e,n){return null==this._registry&&(this._registry={}),this._registry[n]=e},unregister:function(e,n){return delete this._registry[n]},resetRegistry:function(){var e,n,t,o,r;o=this.getRegistrySize(),r=this._registry;for(n in r)e=r[n],e.region.close();return t="There were "+o+" controllers in the registry, there are now "+this.getRegistrySize(),this.getRegistrySize()>0?console.warn(t,this._registry):console.log(t)},getRegistrySize:function(){return r.size(this._registry)}}),c});