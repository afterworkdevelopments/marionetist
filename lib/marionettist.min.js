var extend=function(e,t){function n(){this.constructor=e}for(var o in t)hasProp.call(t,o)&&(e[o]=t[o]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e},hasProp={}.hasOwnProperty;!function(e,t){var n,o,r,i,l,s,u,c,a,p,f;if(e="object"==typeof self&&self.self===self&&self||"object"==typeof global&&global.global===global&&global,"function"==typeof define&&define.amd)return define(["underscore","jquery","backbone","backbone-associations","backbone.marionette","i18next-client","exports","underscore.string","numeral","moment","moment-range"],function(n,o,r,i,l,s,u,c,a,p,f){var d;d=t(e,u,r,l,n,o,s,c,a,p),e.Marionettist=d});if("undefined"!=typeof exports){l=require("underscore"),n=void 0,o=require("backbone"),i=require("backbone.marionette"),u=require("i18next-client"),f=require("underscore.string"),r=require("backbone-associations"),p=require("numeral"),c=require("moment"),a=require("moment-range");try{n=require("jquery")}catch(d){s=d}return module.exports=e.Marionettist=t(e,exports,o,i,l,n,u,f,p,c)}return e.Marionettist=t(e,{},e.Backbone,e.Marionette,e._,e.jQuery||e.Zepto||e.ender||e.$,e.i18n,e.s,e.numeral,e.moment)}(this,function(e,t,n,o,r,i,l,s,u,c){var a,p;return null==i&&"undefined"!=typeof console&&null!==console&&console.error("Unable to load jQuery"),null==r&&"undefined"!=typeof console&&null!==console&&console.error("Unable to load Underscore"),null==s&&"undefined"!=typeof console&&null!==console&&console.error("Unable to load Underscore.string"),null==n&&"undefined"!=typeof console&&null!==console&&console.error("Unable to load Backbone"),null==n.AssociatedModel&&"undefined"!=typeof console&&null!==console&&console.error("Unable to load backbone-associations"),null==o&&"undefined"!=typeof console&&null!==console&&console.error("Unable to load Marionette"),null==l&&"undefined"!=typeof console&&null!==console&&console.error("Unable to load i18next"),null==u&&"undefined"!=typeof console&&null!==console&&console.error("Unable to load numeral"),null==c&&"undefined"!=typeof console&&null!==console&&console.error("Unable to load moment"),null==c.range&&"undefined"!=typeof console&&null!==console&&console.error("Unable to load moment-range"),a=o.extend(),a.Backbone=n,a.Marionette=o,a._=r,a.$=i,a.s=s,a.I18n=l,a.numeral=u,a.moment=c,a.Config=new a.Object,p=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return extend(n,t),n.prototype.lookupPaths=["templates/"],n.prototype.engine=function(){var t;return t={},null!=e.HAML&&(t=HAML),null!=e.JST&&(t=JST),t},n}(a.Object),a.Config.options.templates=new p,r.extend(a.Renderer,{render:function(e,t){var n;if(r.isFunction(e))return e(t);if(e!==!1){if(n=this.getTemplate(e),!n)throw"Template "+e+" not found!";return n(t)}},getTemplate:function(e){var t,n,o,i,l,s,u,c,p;if(u=a.Config.getOption("templates").getOption("lookupPaths"),r.isFunction(u)&&(u=u()),!r.isArray(u))throw"lookupPaths most be an array";for(n=0,i=u.length;i>n;n++)for(s=u[n],p=[e,this.withTemplate(e)],o=0,l=p.length;l>o;o++)if(c=p[o],t=a.Config.getOption("templates").getOption("engine"),r.isFunction(t)&&(t=t()),t[s+c])return t[s+c]},withTemplate:function(e){var t;return null!=e?(t=e.split("/"),t.splice(-1,0,"templates"),t.join("/")):void 0}}),a.AppRoute=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return extend(t,e),t.prototype.router=function(){return this.getOption("router")},t.prototype.path=function(){return this.getOption("path")},t.prototype.actionName=function(){return this.getOption("actionName")},t.prototype.controller=function(){return this.getOption("controller")},t}(a.Object),a.AppRouter=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return extend(t,e),t.prototype.onRoute=function(e,t,n){return null!=this.controller&&r.isFunction(this.controller.onRoute)?this.controller.onRoute(this,e,t,n):void 0},t.prototype._setControllerFilters=function(e){var t;return null!=e&&(t={before:{},after:{}},null==e.filters&&(e.filters={}),e.filters=a._.extend(t,e.filters)),e},t.prototype._addAppRoute=function(e,t,n){var i;if(this.controller=this._setControllerFilters(this.controller),i=function(e){return function(){var o;return e.controller.route=new a.AppRoute({controller:e.controller,actionName:n,path:t}),o=e._executeFilter(e.controller.filters.before,e.controller),o!==!1?(e.controller[n](),e._executeFilter(e.controller.filters.after,e.controller)):void 0}}(this),!i)throw new o.Error('Method "'+n+'" was not found on the controller');return this.route(t,n,r.bind(i,e))},t.prototype._executeFilter=function(e,t){var n,o,i,l,s,u,c;for(u=!0,s=r.keys(e),o=0,i=s.length;i>o;o++)switch(l=s[o],n=e[l],c="Action halted by filter '"+l+"'",!1){case!a._.isFunction(n):if(u=n(t),u===!1){"undefined"!=typeof console&&null!==console&&console.warn(c);break}break;case!a._.isObject(n):if(u=this._proccessFilterObject(l,n,t),u===!1){"undefined"!=typeof console&&null!==console&&console.warn(c);break}}return u},t.prototype._proccessFilterObject=function(e,t,n){var o,i,l,s;if(l={method:null,only:[],except:[]},s=a._.extend(l,t),i=n[e],o=n.route.actionName(),!r.isArray(s.only))throw"filter option only, most be an array";if(!r.isArray(s.except))throw"filter option except, most be an array";if(s.only.length>0||s.except.length>0){if(a._.contains(s.only,o)&&!a._.contains(s.except,o)&&a._.isFunction(i))return i()}else if(a._.isFunction(i))return i()},t}(o.AppRouter),a.Views=new a.Object,a.Views.templateHelpers={t:a.I18n.t,formatCurrency:function(e,t){return null==t&&(t="$0,0.00"),a.numeral(e).format(t)},formatNumber:function(e,t){return null==t&&(t="0,0.00"),a.numeral(e).format(t)},formatPercentage:function(e,t){return null==t&&(t="0.00%"),a.numeral(e).format(t)},formatDate:function(e,t){return null==t&&(t="DD-MM-YYYY"),a.moment(e).format(t)}},r.extend(a.View.prototype,{templateHelpers:function(){var e;return e=a.Views.templateHelpers,null!=this.viewContext?(e.viewContext=this.viewContext,a._.isFunction(this.viewContext)&&(e.viewContext=this.viewContext())):e.viewContext={},e}}),a.Views.Collection=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return extend(t,e),t}(o.CollectionView),a.Views.Composite=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return extend(t,e),t}(o.CompositeView),a.Views.Layout=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return extend(t,e),t}(o.LayoutView),a.Views.Item=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return extend(t,e),t}(o.ItemView),a.Entities=new a.Object,a.Entities.Models=new a.Object,a.Entities.Collections=new a.Object,a.Entities.Models.Base=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return extend(t,e),t}(n.Model),n.AssociatedModel&&(a.Entities.Models.Associated=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return extend(t,e),t}(n.AssociatedModel)),a.Entities.Collections.Base=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return extend(t,e),t}(n.Collection),a.Controllers=new a.Object,a.Controllers.Base=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return extend(t,e),t}(a.Object),a.Application=a.Application.extend({Backbone:a.Backbone,Marionette:a.Marionette,_:a._,$:a.$,s:a.s,I18n:a.I18n,numeral:a.numeral,moment:a.moment,Controllers:new a.Object,Entities:new a.Object,Views:new a.Object,navigate:function(e,t){return null==t&&(t={}),a.Backbone.history.navigate(e,t)},getCurrentRoute:function(){var e;return e=a.Backbone.history.fragment,r.isEmpty(e)?null:e},startHistory:function(e){return null==e&&(e={}),null!=a.Backbone.history?a.Backbone.history.start(e):void 0},register:function(e,t){return null==this._registry&&(this._registry={}),this._registry[t]=e},unregister:function(e,t){return delete this._registry[t]},resetRegistry:function(){var e,t,n,o,r;o=this.getRegistrySize(),r=this._registry;for(t in r)e=r[t],e.region.close();return n="There were "+o+" controllers in the registry, there are now "+this.getRegistrySize(),this.getRegistrySize()>0?console.warn(n,this._registry):console.log(n)},getRegistrySize:function(){return r.size(this._registry)}}),a});