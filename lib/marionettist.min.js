var extend=function(e,t){function n(){this.constructor=e}for(var o in t)hasProp.call(t,o)&&(e[o]=t[o]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e},hasProp={}.hasOwnProperty;!function(e,t){var n,o,r,i,l,u,s,c,a,p,f,d,h;if(e="object"==typeof self&&self.self===self&&self||"object"==typeof global&&global.global===global&&global,"function"==typeof define&&define.amd)return define(["underscore","jquery","backbone","backbone.radio","backbone-associations","backbone.marionette","i18next","exports","underscore.string","numeral","moment","moment-range","moment-timezone"],function(n,o,r,i,l,u,s,c,a,p,f,d){var h;h=t(e,s,r,l,n,o,u,c,a,p),e.Marionettist=h});if("undefined"!=typeof exports){u=require("underscore"),n=void 0,o=require("backbone"),i=require("backbone.radio"),l=require("backbone.marionette"),c=require("i18next"),h=require("underscore.string"),r=require("backbone-associations"),d=require("numeral"),a=require("moment"),f=require("moment-timezone"),p=require("moment-range");try{n=require("jquery")}catch(g){s=g}return module.exports=e.Marionettist=t(e,exports,o,l,u,n,c,h,d,a)}return e.Marionettist=t(e,{},e.Backbone,e.Marionette,e._,e.jQuery||e.Zepto||e.ender||e.$,e.i18next,e.s,e.numeral,e.moment)}(this,function(e,t,n,o,r,i,l,u,s,c){var a,p,f;return null==i&&"undefined"!=typeof console&&null!==console&&console.error("Unable to load jQuery"),null==r&&"undefined"!=typeof console&&null!==console&&console.error("Unable to load Underscore"),null==u&&"undefined"!=typeof console&&null!==console&&console.error("Unable to load Underscore.string"),null==n&&"undefined"!=typeof console&&null!==console&&console.error("Unable to load Backbone"),null==n.Radio&&"undefined"!=typeof console&&null!==console&&console.error("Unable to load Backbone.Radio"),null==n.AssociatedModel&&"undefined"!=typeof console&&null!==console&&console.error("Unable to load backbone-associations"),null==o&&"undefined"!=typeof console&&null!==console&&console.error("Unable to load Marionette"),null==l&&"undefined"!=typeof console&&null!==console&&console.error("Unable to load i18next"),null==s&&"undefined"!=typeof console&&null!==console&&console.error("Unable to load numeral"),null==c&&"undefined"!=typeof console&&null!==console&&console.error("Unable to load moment"),null==c.range&&"undefined"!=typeof console&&null!==console&&console.error("Unable to load moment-range"),null==c.tz&&"undefined"!=typeof console&&null!==console&&console.error("Unable to load moment-timezone"),a=o.extend(),a.Backbone=n,a.Marionette=o,a._=r,a.$=i,a.s=u,a.I18n=l,a.numeral=s,a.moment=c,a.channels={request:function(e,t,n){return null==e&&(e="global"),null==t&&(t=""),null==n&&(n={}),a.Backbone.Radio.channel(e).request(t,n)},replyOnce:function(e,t,n){var o;return null==e&&(e="global"),null==t&&(t=""),o=a.Backbone.Radio.channel(e),a._.isFunction(n)?o.replyOnce(t,n):o.replyOnce(n)},reply:function(e,t,n){var o;return null==e&&(e="global"),null==t&&(t=""),o=a.Backbone.Radio.channel(e),a._.isFunction(n)?o.reply(t,n):o.reply(n)},publish:function(e,t,n){return null==e&&(e="global"),null==t&&(t=""),null==n&&(n={}),a.Backbone.Radio.channel(e).trigger(t,n)},subscribe:function(e,t,n){return null==e&&(e="global"),null==t&&(t=""),a.Backbone.Radio.channel(e).on(t,n)}},a.location={refreshRoute:function(e){return null==e&&(e=this.getCurrentRoute()),n.history.loadUrl(e)},navigateTo:function(e,t){return null==t&&(t={}),a.Backbone.history.navigate(e,t)},getCurrentRoute:function(){var e;return e=a.Backbone.history.fragment,a._.isEmpty(e)?null:e},startHistory:function(e){return null==e&&(e={}),null!=a.Backbone.history?a.Backbone.history.start(e):void 0}},a.Env=function(){function e(){this.stage="development"}return e.current=function(){return this._current||(this._current=new e)},e.prototype.isDevelopment=function(){return"development"===this.stage},e.prototype.isProduction=function(){return"production"===this.stage},e.prototype.getLocale=function(){return a.I18n.language},e.prototype.setLocale=function(e,t){var n;return null==e&&(e="en"),null==t&&(t=null),n=a.I18n.language,a.I18n.changeLanguage(e,function(o){return a.channels.publish("marionettist","change:locale",{currentLocale:e,oldLocale:n}),a._.isFunction(t)?t(o):void 0})},e}(),a.Config=new a.Object,p=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return extend(n,t),n.prototype.lookupPaths=["templates/"],n.prototype.engine=function(){var t;return t={},null!=e.HAML&&(t=HAML),null!=e.JST&&(t=JST),t},n}(a.Object),a.Config.options.templates=new p,r.extend(a.Renderer,{render:function(e,t){var n;if(r.isFunction(e))return e(t);if(e!==!1){if(n=this.getTemplate(e),!n)throw"Template "+e+" not found!";return n(t)}},getTemplate:function(e){var t,n,o,i,l,u,s,c,p;if(s=a.Config.getOption("templates").getOption("lookupPaths"),r.isFunction(s)&&(s=s()),!r.isArray(s))throw"lookupPaths most be an array";for(n=0,i=s.length;i>n;n++)for(u=s[n],p=[e,this.withTemplate(e)],o=0,l=p.length;l>o;o++)if(c=p[o],t=a.Config.getOption("templates").getOption("engine"),r.isFunction(t)&&(t=t()),t[u+c])return t[u+c]},withTemplate:function(e){var t;return null!=e?(t=e.split("/"),t.splice(-1,0,"templates"),t.join("/")):void 0}}),a.Utils=a._.extend(new a.Object,{log:function(e,t){var n;if(a.Env.current().isDevelopment()){switch(t=t||"black",n="White",t){case"success":t="Green",n="LimeGreen";break;case"info":t="DodgerBlue",n="Turquoise";break;case"error":t="Red",n="Black";break;case"start":t="OliveDrab",n="PaleGreen";break;case"warning":t="Tomato",n="Black";break;case"end":t="Orchid",n="MediumVioletRed";break;default:t=t}n="White","object"==typeof e?console.log(e):console.log("%c"+e,"color:"+t+";font-weight:bold; background-color: "+n+";")}},waitFor:function(e,t){var n,o;return null==t&&(t={}),o=[],o=r.chain([e]).flatten().value(),(n=a.$).when.apply(n,o).then(function(){return a._.isFunction(t.success)?t.success():void 0},function(e){return a._.isFunction(t.error)?t.error():void 0})}}),a.AppRoute=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return extend(t,e),t.prototype.router=function(){return this.getOption("router")},t.prototype.path=function(){return this.getOption("path")},t.prototype.actionName=function(){return this.getOption("actionName")},t.prototype.controller=function(){return this.getOption("controller")},t}(a.Object),a.AppRouter=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return extend(t,e),t.prototype.onRoute=function(e,t,n){return null!=this.controller&&r.isFunction(this.controller.onRoute)?this.controller.onRoute(this,e,t,n):void 0},t.prototype._setControllerFilters=function(e){var t,n;return null!=e&&(t={before:{},after:{}},n=e.filters,a._.isFunction(n)&&(n=n()),null==e.filters&&(e.filters={}),e.filters=a._.extend(t,n)),e},t.prototype._addAppRoute=function(e,t,n){var i,l;if(this.controller=this._setControllerFilters(e),i=e[n],l=function(e){return function(o){var r;return e.controller.route=new a.AppRoute({controller:e.controller,actionName:n,path:t}),r=e._executeFilter(e.controller.filters.before,e.controller),r!==!1?(e.controller[n].apply(e.controller,e._getParams()),e._executeFilter(e.controller.filters.after,e.controller)):void 0}}(this),!l)throw new o.Error('Method "'+n+'" was not found on the controller');return this.route(t,n,r.bind(l,e))},t.prototype._executeFilter=function(e,t){var n,o,i,l,u,s,c;for(s=!0,u=r.keys(e),o=0,i=u.length;i>o;o++)switch(l=u[o],n=e[l],c="Action halted by filter '"+l+"'",!1){case!a._.isFunction(n):if(s=n(t),s===!1){"undefined"!=typeof console&&null!==console&&console.warn(c);break}break;case!a._.isObject(n):if(s=this._proccessFilterObject(l,n,t),s===!1){"undefined"!=typeof console&&null!==console&&console.warn(c);break}}return s},t.prototype._getParams=function(){var e,t;return t=this._routeToRegExp(this.controller.route.getOption("path")),e=this._extractParameters(t,n.history.getFragment())},t.prototype._proccessFilterObject=function(e,t,n){var o,i,l,u;if(l={method:null,only:[],except:[]},u=a._.extend(l,t),i=n[e],o=n.route.actionName(),!r.isArray(u.only))throw"filter option only, most be an array";if(!r.isArray(u.except))throw"filter option except, most be an array";if(u.only.length>0||u.except.length>0){if(a._.contains(u.only,o)&&!a._.contains(u.except,o)&&a._.isFunction(i))return i.apply(this.controller,this._getParams())}else if(a._.isFunction(i))return i.apply(this.controller,this._getParams())},t}(o.AppRouter),f=o.Region.prototype.show,a.Region=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return extend(t,e),t.prototype.show=function(e,t){var n,o;return t=t||{},n=this.currentView,o=function(o){return function(){var r;return r=[e,a._.extend(t,{preventDestroy:!0})],f.apply(o,r),t.preventDestroy?void 0:n.destroy()}}(this),null!=n&&a._.isFunction(n.onHide)?n.onHide(o,this):o()},t}(o.Region),a.Views=new a.Object,a.Views.templateHelpers={t:a.I18n.t,formatCurrency:function(e,t){return null==t&&(t="$0,0.00"),a.numeral(e).format(t)},formatNumber:function(e,t){return null==t&&(t="0,0.00"),a.numeral(e).format(t)},formatPercentage:function(e,t){return null==t&&(t="0.00%"),a.numeral(e).format(t)},formatDate:function(e,t){return null==t&&(t="DD-MM-YYYY"),a.moment(e).format(t)}},r.extend(a.View.prototype,{templateHelpers:function(){var e;return e=a.Views.templateHelpers,null!=this.viewContext?(e.viewContext=this.viewContext,a._.isFunction(this.viewContext)&&(e.viewContext=this.viewContext())):e.viewContext={},e}}),a.Views.Collection=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return extend(t,e),t}(o.CollectionView),a.Views.Composite=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return extend(t,e),t}(o.CompositeView),a.Views.Layout=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return extend(t,e),t}(o.LayoutView),a.Views.Item=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return extend(t,e),t}(o.ItemView),a.Entities=new a.Object,a.Entities.Models=new a.Object,a.Entities.Collections=new a.Object,a.Entities.Models.Base=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return extend(t,e),t}(n.Model),n.AssociatedModel&&(a.Entities.Models.Associated=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return extend(t,e),t}(n.AssociatedModel)),a.Entities.Collections.Base=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return extend(t,e),t}(n.Collection),a.Controllers=new a.Object,a.Controllers.Base=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return extend(t,e),t}(a.Object),a.Application=a.Application.extend({Backbone:a.Backbone,Marionette:a.Marionette,_:a._,$:a.$,s:a.s,I18n:a.I18n,numeral:a.numeral,moment:a.moment,Controllers:new a.Object,Entities:new a.Object,Views:new a.Object,navigateTo:function(e,t){return null==t&&(t={}),a.location.navigateTo(e,t)},getCurrentRoute:function(){return a.location.getCurrentRoute()},startHistory:function(e){return null==e&&(e={}),a.location.startHistory(e)},register:function(e,t){return null==this._registry&&(this._registry={}),this._registry[t]=e},unregister:function(e,t){return delete this._registry[t]},resetRegistry:function(){var e,t,n,o,r;o=this.getRegistrySize(),r=this._registry;for(t in r)e=r[t],e.region.close();return n="There were "+o+" controllers in the registry, there are now "+this.getRegistrySize(),this.getRegistrySize()>0?console.warn(n,this._registry):console.log(n)},getRegistrySize:function(){return a._.size(this._registry)}}),a});